<html>

<head>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
</head>

<style>
    html {
        display: flex;
        height: 100%;
        flex-direction: row;
    }

    body {
        flex-grow: 1;
        flex-shrink: 1;
        flex-basis: 0;
        overflow: hidden;
        font-family: monospace;
        white-space: pre-line;
        user-select: none;
        background-color: lightsteelblue;
        display: flex;
        margin: 0;
        flex-direction: column;
    }

    #keyboard {
        display: flex;
        flex-direction: row;
        height: 100%;
    }

    .column {
        /* transform: translate(-50%); */
        display: flex;
        flex-direction: column;
        z-index: 1;
    }

    .key {
        min-width: 25px;
        width: auto;
        border: 2px solid darkgray;
        background-color: lightgray;
        height: 100%;
        color: lightcoral;
        flex-grow: 1;
        flex-basis: 0;
        transition: 100ms;
    }

    .key:focus {
        /* transform: translate(-50%); */
        width: 50px;
        color: royalblue;
        flex-grow: 2;
        transition: 100ms;
    }

    /* #input {
        display: flex;
    } */

    #input2 {
        display: flex;
        position: absolute;
        transform: translate(-100%);
        flex-grow: 2;
        min-width: 10px !important;
    }

    #next {
        display: flex;
        position: absolute;
        transform: translate(200%);
        flex-grow: 2;
        min-width: 10px !important;
        color: lightcoral;
    }

    /* #word {
        background-color: aquamarine;
    } */

    /* #letterbox {
        background-color: aquamarine;
        text-decoration: underline;
    } */

    .hidden {
        /* display: none; */
        opacity: 0;
    }
</style>

<body>
    <!-- <div id="input">
        <span id="word"></span>
        <span id="letterbox"></span>
    </div> -->
    <div id="input2"></div>
    <div id="keyboard"></div>
    <div id="next">...?</div>
</body>

<script>
    pushCol();

    function pushCol() {
        document.getElementById("keyboard").appendChild(column());
    }

    function popCol() {
        document.getElementById("keyboard").removeChild(document.getElementById("keyboard").lastChild);
    }

    function keyhover() {
        // document.getElementById("letterbox").innerText = event.target.innerText;
        event.target.tabIndex = -1;
        event.target.focus();


        var position = event.target.getBoundingClientRect();
        var x = position.left;
        var y = position.top;

        document.getElementById("input2").style.left = x;
        document.getElementById("input2").style.top = y;
        document.getElementById("next").style.left = x;
        document.getElementById("next").style.top = y;
    }

    function columnenter() {
        while (Number(document.getElementById("keyboard").lastChild.id) > 1 + Number(event.target.id)) popCol();

        // document.getElementById("word").innerText = document.getElementById("word").innerText.slice(0, Number(event.target.id));
        while (document.getElementById("input2").childElementCount > Number(event.target.id))
            document.getElementById("input2").removeChild(document.getElementById("input2").lastChild);
        event.target.classList.remove("hidden");
    }

    function columnleave() {
        while (Number(document.getElementById("keyboard").lastChild.id) <= Number(event.target.id)) pushCol();

        // document.getElementById("word").innerText += document.getElementById("letterbox").innerText;
        document.getElementById("input2").appendChild(document.activeElement.cloneNode(true));
        event.target.classList.add("hidden");
    }

    function columndown() {
        event.target.releasePointerCapture(event.pointerId);
        // document.getElementById("letterbox").classList.remove("hidden");
        document.getElementById("input2").style.transform = "translate(-100%)";

    }

    function columnup() {
        // document.getElementById("letterbox").classList.add("hidden");
        document.getElementById("input2").appendChild(document.activeElement.cloneNode(true));
        document.getElementById("input2").style.transform = "translate(calc(-100% + 30px))";
        popCol();
    }

    function column() {
        const column = document.createElement("div");
        column.classList.add("column");
        column.addEventListener("pointerenter", columnenter);
        column.addEventListener("pointerleave", columnleave);
        column.addEventListener("pointerdown", columndown);
        column.addEventListener("pointerup", columnup);
        column.id = document.getElementById("keyboard").children.length;
        for (i = 97; i <= 122; i++) {
            const key = document.createElement("div");
            key.classList.add("key");
            key.addEventListener("pointerdown", keydown);
            key.addEventListener("pointerover", keyhover);
            key.innerText = String.fromCharCode(i);
            column.appendChild(key);
        }
        return column;
    }
</script>

</html>