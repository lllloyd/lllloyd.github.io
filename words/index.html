<html>

<head>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
</head>

<style>
    html {
        display: flex;
        height: 100%;
        flex-direction: row;
    }

    body {
        flex-grow: 1;
        flex-shrink: 1;
        flex-basis: 0;
        overflow: hidden;
        font-family: monospace;
        white-space: pre-line;
        user-select: none;
        background-color: lightgoldenrodyellow;
        display: flex;
        margin: 0;
        flex-direction: column;
    }

    #keyboard {
        display: flex;
        flex-direction: row;
        height: 100%;
    }

    .column {
        display: flex;
        flex-direction: column;
        border: 2px solid lightgray;
    }

    .key {
        min-width: 25px;
        width: auto;
        border: 2px solid darkgray;
        background-color: lightgreen;
        height: 100%;
        color: red;
        flex-grow: 1;
        flex-basis: 0;
        transition: 100ms;
    }

    .key:focus {
        width: 50px;
        color: blue;
        z-index: 1;
        flex-grow: 2;
        transition: 100ms;
    }

    #input {
        display: flex;
    }

    #word {
        background-color: aquamarine;
    }

    #letterbox {
        background-color: aquamarine;
        text-decoration: underline;
    }

    .hidden {
        display: none;
    }
</style>

<body>
    <div id="input">
        <span id="word"></span>
        <span id="letterbox"></span>
    </div>
    <div id="keyboard"></div>
</body>

<script>
    pushCol();

    function pushCol() {
        document.getElementById("keyboard").appendChild(column());
    }

    function popCol() {
        document.getElementById("keyboard").removeChild(document.getElementById("keyboard").lastChild);
    }

    function keyhover() {
        event.target.releasePointerCapture(event.pointerId);
        document.getElementById("letterbox").innerText = event.target.innerText;
        event.target.tabIndex = -1;
        event.target.focus();
    }

    function columnenter() {
        if (Number(document.getElementById("keyboard").lastChild.id) === Number(event.target.id)) pushCol();
        else while (Number(document.getElementById("keyboard").lastChild.id) > 1 + Number(event.target.id)) popCol();
        document.getElementById("word").innerText = document.getElementById("word").innerText.slice(0, Number(event.target.id));
    }

    function columnleave() {
        document.getElementById("word").innerText += document.getElementById("letterbox").innerText;
    }

    function columndown() {
        document.getElementById("letterbox").classList.remove("hidden");
    }

    function columnup() {
        document.getElementById("letterbox").classList.add("hidden");
        popCol();
    }

    function column() {
        const column = document.createElement("div");
        column.classList.add("column");
        column.addEventListener("pointerenter", columnenter);
        column.addEventListener("pointerleave", columnleave);
        column.addEventListener("pointerdown", columndown);
        column.addEventListener("pointerup", columnup);
        column.id = document.getElementById("keyboard").children.length;
        for (i = 97; i <= 122; i++) {
            const key = document.createElement("span");
            key.classList.add("key");
            key.addEventListener("pointerover", keyhover);
            key.innerText = String.fromCharCode(i);
            column.appendChild(key);
        }
        return column;
    }
</script>

</html>